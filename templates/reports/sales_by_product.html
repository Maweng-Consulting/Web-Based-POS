{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-3">
        <h3>Sales By Product</h3>
    </div>
  </div>
  <hr>
  <div class="row">
    <div class="col-8">
      <form method="POST">
        {% csrf_token %}
        
          <div class="row">
            <div class="col-3">
              <input type="text" class="form-control" name="product_name" id="product_name" placeholder="Product..." onchange="getDates()">
            </div>

            <div class="col-3">
              <select class="form-select" id="month_value" name="month_value" onchange="getDates()">
                <option value=""></option>  
                <option value="1">January</option>
                  <option value="2">February</option>
                  <option value="3">March</option>
                  <option value="4">April</option>
                  <option value="5">May</option>
                  <option value="6">June</option>
                  <option value="7">July</option>
                  <option value="8">August</option>
                  <option value="9">September</option>
                  <option value="10">October</option>
                  <option value="11">November</option>
                  <option value="12">December</option>
              </select>
            </div>
          <div class="col-3">
              <select class="form-select" id="year_value" name="year_value" onchange="getDates()">
                <option value=""></option>  
                <option value="2024">2024</option>
                  <option value="2025">2025</option>
                  <option value="2026">2026</option>
                  <option value="2027">2027</option>
                  <option value="2028">2028</option>
                  <option value="2029">2029</option>
                  <option value="2030">2030</option>
                  <option value="2031">2031</option>
                  <option value="2032">2032</option>
                  <option value="2033">2033</option>
                  <option value="2034">2034</option>
                  <option value="2035">2035</option>
              </select>
          </div>
            
            <div class="col-3">
              <button class="btn btn-success">Filter</button>
            </div>
          </div>
          
      </form>
    </div>
   
    <div class="col-4">
      <form method="POST" id="downloadForm">
        {% csrf_token %}
        <div class="input-group mb-3">
          <div class="row">
            <div class="col">
              <input type="text" class="form-control" hidden id="action_type" name="action_type" value="export">
            </div>
            <div class="col">
              <input type="text" hidden class="form-control" id="product_name" name="product_name">
            </div>
            <div class="col">
                <input type="text" hidden class="form-control" id="product_sale_month" name="product_sale_month">
              </div>

              <div class="col">
                <input type="text" hidden class="form-control" id="product_sale_year" name="product_sale_year">
              </div>
            
            <div class="col">
              <button class="btn btn-success">Export</button>
            </div>
          </div>
          
        </div>
    
      </form>

    </div>

</div>

<hr/>
      <div class="table-responsive small">
        <table class="table table-sm">
          <thead>
            <tr>
              <th scope="col">ID</th>
              <th scope="col">Sold On</th>
              <th scope="col">Item</th>
              <th scope="col">Unit Price</th>
              <th scope="col">Quantity</th>
              <th scope="col">Total Cost</th>
            </tr>
          </thead>
          <tbody>
            {% for product_sale in page_obj %}
            <tr>
              <td>{{product_sale.id}}</td>
              <td>{{product_sale.created.date}}</td>
              <td>{{product_sale.item.name}}</td>
              <td>{{product_sale.unit_price}}</td>
              <td>{{product_sale.total_quantity}}</td>
              <td>{{product_sale.total_price}}</td>
            </tr>
           
           
            {% endfor %}

          </tbody>
        </table>
        <div>
          <nav aria-label="Page navigation example">
            <ul class="pagination justify-content-end">
              {% if page_obj.has_previous %}   
                <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}">Previous</a></li>
              {% endif %}
              <a class="page-link" href="#">{{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</a>
              {% if page_obj.has_next %}    
              <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a></li>
              {% endif %}   
            </ul>
          </nav>
        </div>
      </div>
{% endblock content %}
{% block additional_scripts %}

<script>

  const getDates = async () => {
    console.log("Form Filltered!!!!!!!!!")
    var product = document.getElementById("product_name");
    var productValue = product.value;

    var month = document.getElementById("month_value");
    var monthValue = month.value;

    var year = document.getElementById("year_value");
    var yearValue = year.value;

    if (productValue || monthValue || yearValue) {
      sessionStorage.setItem("product_name", productValue)
      sessionStorage.setItem("month_value", monthValue)
      sessionStorage.setItem("year_value", yearValue)
    }

    console.log(`Product: ${productValue}, Year: ${yearValue}, Month: ${monthValue}`)
  }

  function loadFormData() {
    var form = document.getElementById('downloadForm');
    form.elements['product_name'].value = sessionStorage.getItem('product_value') || '';
    form.elements['product_sale_month'].value = sessionStorage.getItem('month_value') || '';
    form.elements['product_sale_year'].value = sessionStorage.getItem('year_value') || '';
  }

    // Load form data from sessionStorage when the DOM content is loaded
    document.addEventListener('DOMContentLoaded', loadFormData);


</script>

{% endblock additional_scripts %}